name: Update IPTV txt

on:
#   schedule:
#     - cron: 0 0 6,17,23 * * ? 
  workflow_dispatch:

jobs:
  Update:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: GetTime
      id: date
      run: echo "::set-output name=date::$(date +'%Y-%m-%d %H:%M:%S CST')"

    - name: Update
      run: |
        # cms.gohkh6.my.eu.org
        rm -f live.txt && wget https://cms.gohkh6.my.eu.org/live.txt -O live.txt
        
        
        # æœˆå…‰å®ç›’
        rm -f bhzb.txt && wget https://gitcode.net/ygbh66/test/-/raw/master/bhzb.txt -O bhzb.txt
        sed -i 's/é¦¬ä¾†è¥¿äºæµ‹è¯•_555,#genre#/é¦¬ä¾†è¥¿äºæµ‹è¯•,#genre#/' bhzb.txt
        sed -i 's/æ–°åŠ å¡æµ‹è¯•_555,#genre#/æ–°åŠ å¡æµ‹è¯•,#genre#/' bhzb.txt  
        sed -i 's/æ–°é—»æµ‹è¯•_555,#genre#/æ–°é—»æµ‹è¯•,#genre#/' bhzb.txt
        sed -i 's/éŸ³ä¹æµ‹è¯•_555,#genre#/éŸ³ä¹æµ‹è¯•,#genre#/' bhzb.txt
        sed -i 's/ä½“è‚²æµ‹è¯•_555,#genre#/ä½“è‚²æµ‹è¯•,#genre#/' bhzb.txt
        sed -i 's/çŸ¥è¯†æµ‹è¯•_555,#genre#/çŸ¥è¯†æµ‹è¯•,#genre#/' bhzb.txt
        sed -i 's/ç”µå½±æµ‹è¯•_555,#genre#/ç”µå½±æµ‹è¯•,#genre#/' bhzb.txt
        sed -i 's/ğŸ’GAæµ‹è¯•1_555,#genre#/GAæµ‹è¯•1,#genre#/' bhzb.txt
        sed -i 's/å¼¯å¼¯æµ‹è¯•_555,#genre#/å¼¯å¼¯æµ‹è¯•,#genre#/' bhzb.txt
        
        

         # æ•´åˆæº
        rm -f IPTV.txt && touch IPTV.txt
        cat live.txt >> IPTV.txt
        cat bhzb.txt >> IPTV.txt
        sed -i '/ğŸŒˆå½©è™¹é »é“_555,#genre#,/$/{/ğŸŒˆå½©è™¹é »é“_555,#genre#/b; d}' IPTV.txt
        sed -i 's/ğŸŒˆå½©è™¹é »é“_555,#genre#/https://github.com/gohhh1234/iptv/' IPTV.txt
       
    
    - name: Clean
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add -A
        git commit -a -m "${{ steps.date.outputs.date }}"

    - name: Push
      run: git push origin master
